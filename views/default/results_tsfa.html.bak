{{extend 'layout.html'}}

<script src="/magneto/static/js/linkurious/src/sigma.core.js"></script>
<script src="/magneto/static/js/linkurious/src/conrad.js"></script>
<script src="/magneto/static/js/linkurious/src/utils/sigma.utils.js"></script>
<script src="/magneto/static/js/linkurious/src/utils/sigma.polyfills.js"></script>
<script src="/magneto/static/js/linkurious/src/sigma.settings.js"></script>
<script src="/magneto/static/js/linkurious/src/classes/sigma.classes.dispatcher.js"></script>
<script src="/magneto/static/js/linkurious/src/classes/sigma.classes.configurable.js"></script>
<script src="/magneto/static/js/linkurious/src/classes/sigma.classes.graph.js"></script>
<script src="/magneto/static/js/linkurious/src/classes/sigma.classes.camera.js"></script>
<script src="/magneto/static/js/linkurious/src/classes/sigma.classes.quad.js"></script>
<script src="/magneto/static/js/linkurious/src/classes/sigma.classes.edgequad.js"></script>
<script src="/magneto/static/js/linkurious/src/captors/sigma.captors.mouse.js"></script>
<script src="/magneto/static/js/linkurious/src/captors/sigma.captors.touch.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/sigma.renderers.canvas.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="/magneto/static/js/linkurious/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="/magneto/static/js/linkurious/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="/magneto/static/js/linkurious/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="/magneto/static/js/linkurious/src/misc/sigma.misc.animation.js"></script>
<script src="/magneto/static/js/linkurious/src/misc/sigma.misc.bindEvents.js"></script>
<script src="/magneto/static/js/linkurious/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="/magneto/static/js/linkurious/src/misc/sigma.misc.drawHovers.js"></script>
<script src="/magneto/static/js/linkurious/plugins/sigma.plugins.filter/sigma.plugins.filter.js"></script>
<script src="/magneto/static/js/linkurious/plugins/sigma.renderers.linkurious/canvas/sigma.canvas.nodes.def.js"></script>
<script src="/magneto/static/js/linkurious/plugins/sigma.plugins.animate/sigma.plugins.animate.js"></script>
<script src="/magneto/static/js/linkurious/plugins/sigma.layout.forceAtlas2/worker.js"></script>
<script src="/magneto/static/js/linkurious/plugins/sigma.layout.forceAtlas2/supervisor.js"></script>
<script src="/magneto/static/js/linkurious/plugins/sigma.plugins.locate/sigma.plugins.locate.js"></script>
<script src="/magneto/static/js/linkurious/plugins/sigma.plugins.tooltips/sigma.plugins.tooltips.js"></script>
<script src="{{=URL('static','js/d3.min.js')}}"></script>
<script src="{{=URL('static','js/logo.js')}}"></script>
<script src="{{=URL('static','js/d3.layout.cloud.js')}}"></script>
<script src="/magneto/static/js/mapper.js"></script>
<script src="/magneto/static/js/underscore.js"></script>
<script src="/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js"></script>
<script src="{{=URL('static','js/selectize.min.js')}}"></script>
<link rel="stylesheet" href="/magneto/static/css/selectize.bootstrap3.css">
<style>


.dropdown-submenu {
    position: relative;
}

.bs-callout {
    padding: 20px;
    margin: 20px 0;
    border: 1px solid #eee;
    border-left-width: 5px;
    border-radius: 3px;
}
.bs-callout h4 {
    margin-top: 0;
    margin-bottom: 5px;
}
.bs-callout p:last-child {
    margin-bottom: 0;
}
.bs-callout code {
    border-radius: 3px;
}
.bs-callout+.bs-callout {
    margin-top: -5px;
}
.bs-callout-default {
    border-left-color: #777;
}
.bs-callout-default h4 {
    color: #777;
}
.bs-callout-primary {
    border-left-color: #428bca;
}
.bs-callout-primary h4 {
    color: #428bca;
}
.bs-callout-success {
    border-left-color: #5cb85c;
}
.bs-callout-success h4 {
    color: #5cb85c;
}
.bs-callout-danger {
    border-left-color: #d9534f;
}
.bs-callout-danger h4 {
    color: #d9534f;
}
.bs-callout-warning {
    border-left-color: #f0ad4e;
}
.bs-callout-warning h4 {
    color: #f0ad4e;
}
.bs-callout-info {
    border-left-color: #5bc0de;
}
.bs-callout-info h4 {
    color: #5bc0de;
}
circle.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

line.link {
  stroke: #999;
  stroke-opacity: .6;
}
    
.disabledTab {
    pointer-events: none;
}
    .sigma-scene{
        position: auto;
    }
    
    #graph-container 
   {
    text-align: left;
    height: 10px;
    margin-bottom: 300px;
   }
        .row-centered {
    text-align:center;
}
.col-centered {
    display:inline-block;
    float:none;
    /* reset the text-align */
    text-align:left;
    /* inline-block space fix */
    margin-right:-4px;
}
    #legend{
        visibility: hidden;
    }
        #network_panel{
        visibility: hidden;
    }
            #results_panel{
        visibility: hidden;
    }
            #stats_panel{
        visibility: hidden;
    }
 .disabled{
 cursor: not-allowed; 

}
    
    #res {padding-top:-250px;}
.disabled > a{
 pointer-events: none;
}
</style>

{{files=["Cfisher","Ffisher","Pfisher","Kfisher","Rfisher","Ofisher","KDifisher","KDrfisher","DBfisher","Orfisher","Tfisher","HPifisher"]}}
{{files_id=["C","F","P","K","R","O","KDi","KDr","DB","Or","T","HPi"]}}
  <ul class="nav nav-pills nav-justified" role="tablist">
      <li role="presentation" class="dropdown" ><a href="#functional" aria-controls="functional" role="tab" data-toggle="dropdown" id="sample_sel">Select a sample</a>
            <ul id="sample" class="dropdown-menu" >
                {{for i in mapping_column:}}
                 <li id="sample_value" value="{{=i[0]}}" onclick="$.web2py.component('{{=URL('default','load_bar_plot.load',args=[request.args[0].strip(),i[0]])}};','bar_plot');
                                                           return_value({{=i[0]}});load_db_table();
                                                           $.web2py.component('{{=URL('default', 'load_stats.load',args=[request.args[0],i[0],sample_number,True])}};', 'stat');
                                                           $.web2py.component('{{=URL('default', 'load_request.load',args=[request.args[0],i[0]])}};','graph-container');change_text();">
                     <a class="sv" id="sv" value="{{=i[0]}}" href="#{{=i[0]}}" data-toggle="tab">{{=i[1]}}</a></li>{{pass}}
            </ul>
          </li>
    <li role="presentation" id="statistics" class="disabled disabledTab" ><a aria-controls="Statistics">Statistics</a>
      <ul id="statistic_menu" class="dropdown-menu">
                <li><a id="s_li" onclick="remove_active();" data-toggle="tab">Network statistics</a></li>

          {{if len(mapping_column)>0:}}
                <li><a id="cp_li" data-toggle="tab" onclick="remove_active();$.web2py.component('{{=URL('default', 'load_circle.load',args=[request.args[0]])}};', 'cp');">Enriched terms statistic</a></li>
          {{pass}}
        </ul>
      </li>
    <li role="presentation" id="network" class="disabled disabledTab"><a id="net" aria-controls="network" role="tab" data-toggle="tab">Network</a></li>
    <li id="func_anal" role="presentation" class="dropdown disabled disabledTab"><a class="dropdown-toggle" href="#functional" aria-controls="functional" id="fa" role="tab" data-toggle="dropdown">Functional Analysis</a>
            <ul id="fa" class="dropdown-menu">
                <li><a class="dbfa" id="C" data-toggle="tab">GO Component</a></li>
                <li><a class="dbfa" id="F" data-toggle="tab">GO Function</a></li>
                <li><a class="dbfa" id="P" data-toggle="tab">GO Process</a></li>
                <li><a class="dbfa" id="R" data-toggle="tab">Reactome</a></li>
                <li><a class="dbfa" id="K" data-toggle="tab">Kegg</a></li>
                <li><a class="dbfa" id="KDi" data-toggle="tab">Kegg disease</a></li>
                <li><a class="dbfa" id="O" data-toggle="tab">Omim</a></li>
                <li><a class="dbfa" id="Or" data-toggle="tab">Orphanet</a></li>
                <li><a class="dbfa" id="KDr" data-toggle="tab">Kegg drug</a></li>
                <li><a class="dbfa" id="DB" data-toggle="tab">Drug Bank</a></li>
                <li><a class="dbfa" id="T" data-toggle="tab">Toxins</a></li>
                <li><a class="dbfa" id="HPi" data-toggle="tab">Virus</a></li>
                <li class="divider">Hierarchy enrichment</li>
                <li id="sub" class="dropdown-submenu">
                    <a class="dbfa" tabindex="-1" id="R_h" href="#">Reactome hierarchy<span class="caret"></span></a>
                        <ul class="dropdown-menu dm" id="Reactome" style="position:absolute;display: none;left:100%;top:0px;margin-top: 0px;margin-left:-5px;margin:-1px; padding:0;">
                    </ul>

                    <a class="dbfa" id="K_h" tabindex="-1" href="#">Kegg hierarchy<span class="caret"></span></a>
                       <ul class="dropdown-menu dm" id="Kegg" style="position:absolute;display: none;left:100%;top:26px;margin-top: 0px;margin-left:-5px;margin:-1px; padding:0;">
                    </ul>
                    
                    <a class="dbfa" id="KDr_h" tabindex="-1" href="#">Kegg drugs hierarchy<span class="caret"></span></a>
                      <ul class="dropdown-menu dm" id="Kegg_drugs" style="position:absolute;display: none;left:100%;top:52px;margin-top: 0px;margin-left:-5px;margin:-1px; padding:0;">
                    </ul>
                    
                    <a class="dbfa" id="DB_h" tabindex="-1" href="#">DrugBank hierarchy<span class="caret"></span></a>
                      <ul class="dropdown-menu dm" id="Drug_bank" style="position:absolute;display: none;left:100%;top:78px;margin-top: 0px;margin-left:-5px;margin:-1px; padding:0;">
                    </ul>
                    
                    <a class="dbfa" id="KDi_h" tabindex="-1" href="#">Kegg disease hierarchy<span class="caret"></span></a>
                     <ul class="dropdown-menu dm" id="Kegg_disease" style="position:absolute;display: none;left:100%;top:104px;margin-top: 0px;margin-left:-5px;margin:-1px; padding:0;">
                    </ul>
                    
                    <a class="dbfa" id="Or_h" tabindex="-1" href="#">Orphanet hierarchy<span class="caret"></span></a>
                   <ul class="dropdown-menu dm" id="Orphanet" style="position:absolute;display: none;left:100%;top:130px;margin-top: 0px;margin-left:-5px;margin:-1px; padding:0;">
                    </ul>
                </li>
              </li>
            </ul>
          </li>
    <li class="dropdown disabled disabledTab" id="plot"><a class="dropdown-toggle" href="#plot" aria-controls="plot" id="drawplot" role="tab" data-toggle="dropdown">Plot</a>
       <ul class="dropdown-menu">
        <li id="chord_plot" class="test"><a id="cplot" data-toggle="tab" onclick="chord_select();$.web2py.component('{{=URL('default','load_chord.load',args=request.args[0].strip())}};','chord');">Chord Plot</a></li>
        <li id="treemap_plot"><a id="tp" href="#Treemap" data-toggle="tab" onclick="treemap_select();$.web2py.component('{{=URL('default','load_treemap.load',args=request.args[0].strip())}};','treemap');">Treemap Plot</a></li>
        <li id="bubble_plot"><a id="bp" href="#bubble" data-toggle="tab" onclick="bubble_select();$.web2py.component('{{=URL('default','load_bubble.load',args=request.args[0].strip())}};','bubble');">Bubble Plot</a></li>
        <li id="wc_plot"><a id="wcp" href="#word" data-toggle="tab" onclick="word_cloud_select();$.web2py.component('{{=URL('default','load_word_cloud.load',args=request.args[0].strip())}};','word');">Word Cloud Plot</a></li>
        <li class="disabled" id="hierarchy_plot"><a id="hp" data-toggle="tab" onclick="hierarchy_select();$.web2py.component('{{=URL('default','load_hierarchy.load',args=request.args[0].strip())}};','hierarchy_tree');">Hierarchy Plot</a></li>

            </ul>
   </li>
</ul>
<br>
  <div id="stats_panel" class="panel panel-primary" >
      <div class="panel-heading">Statistics</div>
      <div class="panel-body">
          <div id="stat"></div>
          <div class="row">
              <div class="col-md-6" id="bar_plot"></div>
              <div class="col-md-6" id="db_stats"></div>
          </div>
          <p>
                <div id="cp"></div>
          </p>

      </div>
</div>

   <div id="network_panel" class="panel panel-primary" >
      <div class="panel-heading">Network</div>
       <div class="panel-body"><div id="graph-container"></div>
<br>
<div id="legend" class="row row-centered">
{{for i in databases:}}
<div class="col-md-2 col-centered">
   <div class="thumbnail">
    <center> <h4> {{=i}}</h4></center> {{for j in databases[i]:}}
      <p>
          </p>
       <svg width="30" height="30"> <circle cx="25" cy="25" r="5" fill="{{=alias_colors[j]}}" /><span>{{=alias_dict[j]}}</span></svg>
          {{pass}}
      </div>
    </div>
   {{pass}}
</div>
 </div></div>

  <div id="results_panel" class="panel panel-primary" >
      <div class="panel-heading">Functional Analysis</div>
      <div class="panel-body">
          <div id="results">
              <link rel="stylesheet" href="/magneto/static/js/bootstrap-table/dist/bootstrap-table.css">

      </div></div></div>

<div id="chord"></div>
<div id="treemap"></div>
<div id="bubble"></div>
<div id="word"></div>
<div id="hierarchy_tree"></div>


<script>
db_not_present={{=XML(db_not_present)}}
no_fisher_magneto={{=XML(no_fisher_magneto)}}
function remove_active(){
 $('#statistics li.active').removeClass('active')

}
$(".dbfa").click(function(event) {
    if (event.currentTarget.className.indexOf("disabled")!=-1){
    $('html, body').animate({
        scrollTop: $("#results_panel").offset().top
    }, 1000);
    }
});
    
$("#s_li").click(function() {
    $('html, body').animate({
        scrollTop: $("#stats_panel").offset().top
    }, 1000);
});
$("#sub").click(function() {
    $('html, body').animate({
        scrollTop: $("#results_panel").offset().top
    }, 1000);
});
    
$("#cp_li").click(function() {
    $('html, body').animate({
        scrollTop: $("#cp").offset().top
    }, 1000);
});

$("#net").click(function() {
    $('html, body').animate({
        scrollTop: $("#network_panel").offset().top
    }, 1000);
});
    
    
$("#cplot").click(function() {
    $('html, body').animate({
        scrollTop: $("#chord").offset().top
    }, 1000);
});
$("#tp").click(function() {
    $('html, body').animate({
        scrollTop: $("#treemap").offset().top
    }, 1000);
});
$("#bp").click(function() {
    $('html, body').animate({
        scrollTop: $("#bubble").offset().top
    }, 1000);
});
$("#wcp").click(function() {
    $('html, body').animate({
        scrollTop: $("#word").offset().top
    }, 1000);
});
$("#hp").click(function() {
    $('html, body').animate({
        scrollTop: $("#hierarchy_tree").offset().top
    }, 1000);
});
    
    
chord_plot_value={{=XML(chord_plot)}}
mapping_column={{=XML(mapping_column)}}
menu_list={{=XML(menu_list)}}
menu_mapping={{=XML(menu_mapping)}}
controls={{=XML(controls)}}
control_sample={{=XML(control_sample)}}
menu_mapping_reverse={{=XML(menu_mapping_reverse)}}

$(document).ready(function(){
$('.dropdown-submenu a')
.mouseover(function() {
        $(this).next('ul').show()
    })

$("#R_h")
.mouseover(function() {
        if (menu_list[value]["R"].length==0)
        {
            $("#Reactome").css("display","none")
        }
    else{
            $("#Reactome").next('ul').show()
        }
        $("#Kegg").css("display","none")
         $("#Kegg_drugs").css("display","none")
          $("#Kegg_disease").css("display","none")
           $("#Orphanet").css("display","none")
            $("#Drug_bank").css("display","none")
    })

$("#K_h")
.mouseover(function() {
    if (menu_list[value]["K"].length==0)
        {
            $("#Kegg").css("display","none")
        }
    else{
            $("#Kegg").next('ul').show()
        }
        $("#Reactome").css("display","none")
         $("#Kegg_drugs").css("display","none")
          $("#Kegg_disease").css("display","none")
           $("#Orphanet").css("display","none")
            $("#Drug_bank").css("display","none")
    })

$("#KDr_h")
.mouseover(function() {
        if (menu_list[value]["KDr"].length==0)
        {
            $("#Kegg_drugs").css("display","none")
        }
    else
        {
            $("#Kegg_drugs").next('ul').show()
        }
        $("#Reactome").css("display","none")
         $("#Kegg").css("display","none")
          $("#Kegg_disease").css("display","none")
           $("#Orphanet").css("display","none")
            $("#Drug_bank").css("display","none")
    })
$("#DB_h")
.mouseover(function() {
    if (menu_list[value]["DB"].length==0)
        {
            $("#Drug_bank").css("display","none")
        }
    else{
            $("#Drug_bank").next('ul').show()
        }

        $("#Reactome").css("display","none")
         $("#Kegg_drugs").css("display","none")
          $("#Kegg_disease").css("display","none")
           $("#Orphanet").css("display","none")
            $("#kegg").css("display","none")
    })
$("#Or_h")
.mouseover(function() {
        if (menu_list[value]["Or"].length==0)
        {
            $("#Orphanet").css("display","none")
        }
        else
        {
            $("#Orphanet").next('ul').show()
        }
        $("#Reactome").css("display","none")
         $("#Kegg_drugs").css("display","none")
          $("#Kegg_disease").css("display","none")
           $("#Kegg").css("display","none")
            $("#Drug_bank").css("display","none")
    })
$("#KDi_h")
.mouseover(function() {
            if (menu_list[value]["KDi"].length==0)
        {
            $("#Kegg_disease").css("display","none")
        }
        else
        {
            $("#Kegg_disease").next('ul').show()
        }
        $("#Reactome").css("display","none")
         $("#Kegg_drugs").css("display","none")
          $("#Orphanet").css("display","none")
           $("#Kegg").css("display","none")
            $("#Drug_bank").css("display","none")
    })


$('#sub')
     .mouseleave(function(event){
      $("#Reactome").hide()
      $("#Kegg").hide()
      $("#Kegg_disease").hide()
      $("#Kegg_drug").hide()
      $("#Drug_bank").hide()
      $("#Orphanet").hide()
    })
})

    function loadScript(url)
{
    document.body.appendChild(document.createElement("script")).src = url;
}

value=""
function return_value(elem){
     value=elem
     document.getElementById("results").innerHTML=""
}
    var sample=""
$(".sv").click(function(event){
    $("#legend").css("visibility", "visible");
    $("#network_panel").css("visibility", "visible");
    $("#stats_panel").css("visibility", "visible");
    $("#results_panel").css("visibility", "hidden");
    $("#func_anal").removeClass('disabled disabledTab');
    $("#statistics").removeClass('disabled disabledTab');
    $("#network").removeClass('disabled disabledTab');
    $("#plot").addClass('disabled disabledTab');
    $("#legend").css("visibility", "visible");
    var selText = $(this).text();
    sample=$(this).attr("value");
    db=["C","P","F","R","K","O","KDr","KDi","DB","Or","T","HPi"]
    for (var i in db) {
        $("#"+db[i]).removeClass('disabled')
        
    }
        document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
    document.getElementById("fa").innerHTML="Functional Analysis<span class='caret'></span>"
    for (i in no_fisher_magneto[sample]){
        
        $("#"+no_fisher_magneto[sample][i]).addClass('bg-danger')
    }
    for (i = 0; i < db_not_present[sample].length; i++){
        $("#"+db_not_present[sample][i]).addClass('disabled')
        
    }
    location.hash = sample;
   $(this).parents('.dropdown').find('.dropdown-toggle').html(selText+" ");
    document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""
    document.getElementById("graph-container").style.height="1000px";
})


mapping={{=XML(str(mapping))}}
$('.stats').click(function(){
    var db_fa=($(this).attr('id'))
    location.hash = db_fa;
})
$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});
    //locate_cluster
$('.dbfa').click(function(event){
    loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");
          

    values=mapping[document.getElementById("sample_sel").innerHTML.trim()]
    
    var folder= "{{=request.args[0]}}"
    var db_fa=($(this).attr('id'))
    temp=db_fa.endsWith("_h")
    location.hash =sample+"#"+db_fa;
    ids=db_fa
    db_fa=db_fa+"fisher.json"
    
    $("#chord_plot").removeClass('disabled');
    $("#chord_plot").removeClass('active');
    
    if (chord_plot_value[sample][ids]>300)
    {
        $("#chord_plot").addClass('disabled');
    }
   if(no_fisher_magneto[sample].indexOf(ids)== -1){
       
       path= "/magneto/static/results/"+folder+"/"+values+"_graph/"+db_fa
       }
   else{
      
    path= "/magneto/static/results/"+folder+"/"+values+"_fisher/"+db_fa
   }
        document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
        
    $("#plot").removeClass('dropdown disabled disabledTab');
    $("#hierarchy_plot").addClass('disabled');
    $("#hierarchy_plot").removeClass('active');

    $("#wc_plot").removeClass('active');
    $("#bubble_plot").removeClass('disabled');
    $("#wc_plot").removeClass('disabled');
    $("#treemap_plot").removeClass('disabled');
    $("#display_plot").removeClass('disabled');
    if(!$(this).hasClass('disabled')){
        $("#results_panel").css("visibility", "visible");

    }
    document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""
    if (!temp)
    { 
        $('#fa').html($(this)[0].innerText+" ");
        is_control=control_sample.indexOf(location.hash.split("#")[1])

        if (Object.keys(controls).length!=0 && is_control)
            
        {
             if($(this).hasClass('disabled'))
            {
                
                $("#results_panel").css("visibility", "hidden");
                $('#fa li.active').removeClass('active')
                $('#func_anal').removeClass('active')
                document.getElementById("fa").innerHTML="Functional Analysis<span class='caret'></span>"
                $("#plot").addClass('dropdown disabled disabledTab');
                return false
            }

document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="control" data-align="center" data-sortable="true" data-formatter="data_formatter_control" data-sorter="controlsorter">In Control</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true" data-order="asc">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
        else
        {
            if($(this).hasClass('disabled'))
            {
                
                $("#results_panel").css("visibility", "hidden");
                $('#fa li.active').removeClass('active')
                $('#func_anal').removeClass('active')
                document.getElementById("fa").innerHTML="Functional Analysis<span class='caret'></span>"
                $("#plot").addClass('dropdown disabled disabledTab');
                return false
            }
           
        document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
    }
    
    if (document.getElementById("drawplot").text==="Chord") {
        
        $.web2py.component('{{=URL('default','load_chord.load',args=request.args[0].strip())}};','chord')
   }
       if (document.getElementById("drawplot").text==="Treemap") {
        $.web2py.component('{{=URL('default','load_treemap.load',args=request.args[0].strip())}};','treemap')
   }
       if (document.getElementById("drawplot").text==="Bubble") {
        $.web2py.component('{{=URL('default','load_bubble.load',args=request.args[0].strip())}};','bubble')
   }
       if (document.getElementById("drawplot").text==="Word Cloud") {
        $.web2py.component('{{=URL('default','load_word_cloud.load',args=request.args[0].strip())}};','word')
   }
});
function download_magneto(){
    value=location.hash.split("#")
    sample=mapping_column[value[1]]
    var folder= "{{=request.args[0]}}"
    path_download="/magneto/static/results/"+folder+"/"+sample+"_magneto.zip"
    window.location.assign(path_download)
}
function download_standard(){
    value=location.hash.split("#")
    sample=mapping_column[value[1]]
    
    var folder= "{{=request.args[0]}}"
    path_download="/magneto/static/results/"+folder+"/"+sample+"_standard.zip"
    window.location.assign(path_download)
}

function change_text() 
    {
    
    document.getElementById("DB_h").className=""
    document.getElementById("K_h").className=""
    document.getElementById("KDi_h").className=""
    document.getElementById("KDr_h").className=""
    document.getElementById("Or_h").className=""
    document.getElementById("R_h").className=""
    value=location.hash.substring(1)
    if (menu_list[value]["R"].length!=0)
    {
        document.getElementById("Reactome").innerHTML=menu_list[value]["R"]
    }
    else{
        d=document.getElementById("R_h")
        d.className += "disabled";
       
    }
     
    if (menu_list[value]["K"].length!=0){
    document.getElementById("Kegg").innerHTML=menu_list[value]["K"]
    }
    else{
        d=document.getElementById("K_h")
        d.className += "disabled";
    }
     
    if (menu_list[value]["KDr"].length!=0)
    {
        document.getElementById("Kegg_drugs").innerHTML=menu_list[value]["KDr"]
    }
    else{
    d=document.getElementById("KDr_h")
        d.className += "disabled";
    }
     
    if (menu_list[value]["KDi"].length!=0){
    document.getElementById("Kegg_disease").innerHTML=menu_list[value]["KDi"]
    }
    else{
        d=document.getElementById("KDi_h")
        d.className += "disabled";
    }
     
    if (menu_list[value]["DB"].length!=0){
    document.getElementById("Drug_bank").innerHTML=menu_list[value]["DB"]
    }
    else{
        d=document.getElementById("DB_h")
        d.className += "disabled";
    }
     
    if (menu_list[value]["Or"].length!=0){
    document.getElementById("Orphanet").innerHTML=menu_list[value]["Or"]
    }
    else{
        d=document.getElementById("Or_h")
        d.className += "disabled";
    }
    }

$('#Reactome').on('click','.test',function(event) { 
    event.preventDefault();
    loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");


    var folder= "{{=request.args[0]}}"
    $("#plot").removeClass('dropdown disabled disabledTab');
    document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
    $('#fa li.active').removeClass('active')
    $("#hierarchy_plot").removeClass('disabled');
    $("#hierarchy_plot").removeClass('active');
    $("#chord_plot").addClass('disabled');
    $("#bubble_plot").addClass('disabled');
    $("#wc_plot").addClass('disabled');
    $("#treemap_plot").addClass('disabled');
    $("#display_plot").addClass('disabled');
    $("#chord_plot").removeClass('active');
    $("#bubble_plot").removeClass('active');
    $("#wc_plot").removeClass('active');
    $("#treemap_plot").removeClass('active');
    $("#display_plot").removeClass('active');
    document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""    
    location.hash =sample+"#R_h#"+menu_mapping[mapping[document.getElementById("sample_sel").innerHTML.trim()]]["R"][$(this).attr('id')];
    path= "/magneto/static/results/"+folder+"/"+sample+"_graph/R_hierarchy/"+$(this).attr('id')+"_fisher.json"
     $('#fa').html("Reactome: "+$(this)[0].innerText+" ");
    $("#results_panel").css("visibility", "visible");
       is_control=control_sample.indexOf(location.hash.split("#")[1])
        if (Object.keys(controls).length!=0 && is_control)
        {
document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="control" data-align="center" data-sortable="true" data-formatter="data_formatter_control" data-sorter="controlsorter">In Control</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true" data-order="asc">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
        else
        {
        document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
});

$('#Orphanet').on('click','.test',function(event) { 
    loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");

    var folder= "{{=request.args[0]}}"
    event.preventDefault();
    $('#fa li.active').removeClass('active')
    location.hash =sample+"#Or_h#"+menu_mapping[mapping[document.getElementById("sample_sel").innerHTML.trim()]]["Or"][$(this).attr('id')];
    path= "/magneto/static/results/"+folder+"/"+sample+"_graph/Or_hierarchy/"+$(this).attr('id')+"_fisher.json"
    $('#fa').html("Orphanet: "+$(this)[0].innerText+" ");
    $("#plot").removeClass('dropdown disabled disabledTab');
   document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
    document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""
    $("#hierarchy_plot").removeClass('disabled');
        $("#hierarchy_plot").removeClass('active');

    $("#chord_plot").addClass('disabled');
    $("#bubble_plot").addClass('disabled');
    $("#wc_plot").addClass('disabled');
    $("#treemap_plot").addClass('disabled');
    $("#display_plot").addClass('disabled');
    $("#chord_plot").removeClass('active');
    $("#bubble_plot").removeClass('active');
    $("#wc_plot").removeClass('active');
    $("#treemap_plot").removeClass('active');
    $("#display_plot").removeClass('active');
    $("#results_panel").css("visibility", "visible");
       is_control=control_sample.indexOf(location.hash.split("#")[1])
        if (Object.keys(controls).length!=0 && is_control)
        {
document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="control" data-align="center" data-sortable="true" data-formatter="data_formatter_control" data-sorter="controlsorter">In Control</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true" data-order="asc">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
        else
        {
        document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
});
    
    
$('#Kegg').on('click','.test',function(event) { 
    loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");

    var folder= "{{=request.args[0]}}"    
    event.preventDefault();
    location.hash =sample+"#K_h#"+menu_mapping[mapping[document.getElementById("sample_sel").innerHTML.trim()]]["K"][$(this).attr('id')];
        path= "/magneto/static/results/"+folder+"/"+sample+"_graph/K_hierarchy/"+$(this).attr('id')+"_fisher.json"
    document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
        $('#fa li.active').removeClass('active')
            document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""
    $('#fa').html("Kegg: "+$(this)[0].innerText+" ");
    $("#plot").removeClass('dropdown disabled disabledTab');
    $("#hierarchy_plot").removeClass('disabled');
        $("#hierarchy_plot").removeClass('active');

    $("#chord_plot").addClass('disabled');
    $("#bubble_plot").addClass('disabled');
    $("#wc_plot").addClass('disabled');
    $("#treemap_plot").addClass('disabled');
    $("#display_plot").addClass('disabled');
    $("#chord_plot").removeClass('active');
    $("#bubble_plot").removeClass('active');
    $("#wc_plot").removeClass('active');
    $("#treemap_plot").removeClass('active');
    $("#display_plot").removeClass('active');
    $("#results_panel").css("visibility", "visible");
        $("#results_panel").css("visibility", "visible");
       is_control=control_sample.indexOf(location.hash.split("#")[1])
        if (Object.keys(controls).length!=0 && is_control)
        {
document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="control" data-align="center" data-sortable="true" data-formatter="data_formatter_control" data-sorter="controlsorter">In Control</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true" data-order="asc">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
        else
        {
        document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered"  data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
});
    
$('#Kegg_disease').on('click','.test',function(event) { 
    loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");
       var folder= "{{=request.args[0]}}"    
        document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""
    $('#fa').html("Kegg Disease: "+$(this)[0].innerText+" ");
    $("#plot").removeClass('dropdown disabled disabledTab');
    document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
    $('#fa li.active').removeClass('active')
    $("#hierarchy_plot").removeClass('disabled');
        $("#hierarchy_plot").removeClass('active');

    $("#chord_plot").addClass('disabled');
    $("#bubble_plot").addClass('disabled');
    $("#wc_plot").addClass('disabled');
    $("#treemap_plot").addClass('disabled');
    $("#display_plot").addClass('disabled');
    $("#chord_plot").removeClass('active');
    $("#bubble_plot").removeClass('active');
    $("#wc_plot").removeClass('active');
    $("#treemap_plot").removeClass('active');
    $("#display_plot").removeClass('active');
    $("#results_panel").css("visibility", "visible");
    event.preventDefault();
    location.hash =sample+"#KDi_h#"+menu_mapping[mapping[document.getElementById("sample_sel").innerHTML.trim()]]["KDi"][$(this).attr('id')];
        path= "/magneto/static/results/"+folder+"/"+sample+"_graph/KDi_hierarchy/"+$(this).attr('id')+"_fisher.json"
    $("#results_panel").css("visibility", "visible");
       is_control=control_sample.indexOf(location.hash.split("#")[1])
        if (Object.keys(controls).length!=0 && is_control)
        {
document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="control" data-align="center" data-sortable="true" data-formatter="data_formatter_control" data-sorter="controlsorter">In Control</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true" data-order="asc">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
        else
        {
        document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
});
    
$('#Kegg_drugs').on('click','.test',function(event) { 
    loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");
    var folder= "{{=request.args[0]}}"    
    event.preventDefault();
        document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""
     $('#fa').html("Kegg Drugs: "+$(this)[0].innerText+" ");
    $("#plot").removeClass('dropdown disabled disabledTab');
    document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
    $('#fa li.active').removeClass('active')
    $("#hierarchy_plot").removeClass('disabled');
    $("#hierarchy_plot").removeClass('active');

    $("#chord_plot").addClass('disabled');
    $("#bubble_plot").addClass('disabled');
    $("#wc_plot").addClass('disabled');
    $("#treemap_plot").addClass('disabled');
    $("#display_plot").addClass('disabled');
    $("#chord_plot").removeClass('active');
    $("#bubble_plot").removeClass('active');
    $("#wc_plot").removeClass('active');
    $("#treemap_plot").removeClass('active');
    $("#display_plot").removeClass('active');
    $("#results_panel").css("visibility", "visible");
    location.hash =sample+"#KDr_h#"+menu_mapping[mapping[document.getElementById("sample_sel").innerHTML.trim()]]["KDr"][$(this).attr('id')];
    path= "/magneto/static/results/"+folder+"/"+sample+"_graph/KDr_hierarchy/"+$(this).attr('id')+"_fisher.json"
    $("#results_panel").css("visibility", "visible");
       is_control=control_sample.indexOf(location.hash.split("#")[1])
        if (Object.keys(controls).length!=0 && is_control)
        {
document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="control" data-align="center" data-sortable="true" data-formatter="data_formatter_control" data-sorter="controlsorter">In Control</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true" data-order="asc">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
        else
        {
        document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
});

$('#Drug_bank').on('click','.test',function(event) {
    loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");
    var folder= "{{=request.args[0]}}"
    event.preventDefault();
    $('#fa').html("DrugBank: "+$(this)[0].innerText+" ");
    $("#plot").removeClass('dropdown disabled disabledTab');
        document.getElementById("chord").innerHTML=""
    document.getElementById("treemap").innerHTML=""
    document.getElementById("bubble").innerHTML=""
    document.getElementById("word").innerHTML=""
    document.getElementById("hierarchy_tree").innerHTML=""
   document.getElementById("drawplot").innerHTML="Plot<span class='caret'></span>"
    $('#fa li.active').removeClass('active')
    $("#hierarchy_plot").removeClass('disabled');
        $("#hierarchy_plot").removeClass('active');

    $("#chord_plot").addClass('disabled');
    $("#bubble_plot").addClass('disabled');
    $("#wc_plot").addClass('disabled');
    $("#treemap_plot").addClass('disabled');
    $("#display_plot").addClass('disabled');
    $("#chord_plot").removeClass('active');
    $("#bubble_plot").removeClass('active');
    $("#wc_plot").removeClass('active');
    $("#treemap_plot").removeClass('active');
    $("#display_plot").removeClass('active');
    $("#results_panel").css("visibility", "visible");
    location.hash =sample+"#DB_h#"+menu_mapping[mapping[document.getElementById("sample_sel").innerHTML.trim()]]["DB"][$(this).attr('id')];
    path= "/magneto/static/results/"+folder+"/"+sample+"_graph/DB_hierarchy/"+$(this).attr('id')+"_fisher.json"
    
    $("#results_panel").css("visibility", "visible");
       is_control=control_sample.indexOf(location.hash.split("#")[1])
        if (Object.keys(controls).length!=0 && is_control)
        {
document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="control" data-align="center" data-sortable="true" data-formatter="data_formatter_control" data-sorter="controlsorter">In Control</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true" data-order="asc">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
        else
        {
        document.getElementById("results").innerHTML = '<div class="export btn-group pull-right"><button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-type="txt"><a onclick="download_standard()">Standard</a></li><li data-type="txt"><a onclick="download_magneto()">MAGNETO</a></li></ul></div><table id="table" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path+' data-sort-name="p value" data-sort-order="asc" data-search="true" data-select-item-name="toolbar1"  data-pagination="true" data-detail-formatter="detailFormatter" data-detail-view="true" data-row-style="rowStyle"><thead><th data-field="id" data-align="left" data-sortable="true">ID</th><th data-field="description" data-align="left" data-sortable="true">Description</th><th data-field="p value" data-align="left" data-sortable="true">P-Value</th><th data-field="proteins involved" data-align="left" data-sortable="true">#Proteins Involved</th></tr></thead></table>';
        }
});
function hierarchy_select()
    {
document.getElementById("drawplot").innerHTML="Hierarchy plot<span class='caret'></span>"
}
function chord_select() 
    {
    $("#treemap_plot").removeClass('active')
     $("#bubble_plot").removeClass('active')
      $("#wc_plot").removeClass('active')
      document.getElementById("treemap").innerHTML=""
      document.getElementById("bubble").innerHTML=""
      document.getElementById("word").innerHTML=""

    document.getElementById("drawplot").innerHTML="Chord<span class='caret'></span>"
    
    }
function treemap_select() 
    {
     $("#chord_plot").removeClass('active')
     $("#bubble_plot").removeClass('active')
     $("#wc_plot").removeClass('active')
      document.getElementById("chord").innerHTML=""
      document.getElementById("bubble").innerHTML=""
      document.getElementById("word").innerHTML=""
    document.getElementById("drawplot").innerHTML="Treemap<span class='caret'></span>"
    }
function bubble_select() 
    {
        
     $("#chord_plot").removeClass('active')
     $("#treemap_plot").removeClass('active')
     $("#wc_plot").removeClass('active')
      document.getElementById("chord").innerHTML=""
      document.getElementById("treemap").innerHTML=""
      document.getElementById("word").innerHTML=""
    document.getElementById("drawplot").innerHTML="Bubble<span class='caret'></span>"
    }
function word_cloud_select() 
    {
      document.getElementById("chord").innerHTML=""
      document.getElementById("treemap").innerHTML=""
      document.getElementById("bubble").innerHTML=""
     $("#chord_plot").removeClass('active')
     $("#treemap_plot").removeClass('active')
     $("#bubble_plot").removeClass('active')
        loadScript("/magneto/static/js/d3.layout.cloud.js")
    document.getElementById("drawplot").innerHTML="Word Cloud<span class='caret'></span>"
    }

    function detailFormatter(index, row) {
       starting_nodes={{=XML(str(starting_nodes))}}
       values=mapping[document.getElementById("sample_sel").text.trim()]
       protein=starting_nodes[values]
       var html = ['<span><b> proteins involved: </b></span>'];
       for (i = 0; i < row.proteins.length; i++) { 
            var index= protein.indexOf(row.proteins[i].split("(")[0])
            
            if (index!=-1)
            {
                html.push('<font color="red"> ' + row.proteins[i] + ' </font>');
            }
            else
            { if (row.common!=2){
                html.push(" "+row.proteins[i] );
            }
            }
        }
        return html.join('');
    }
     function data_formatter_control(value,row) {
        var presence=control_sample.indexOf(location.hash.split("#")[1])
        
        if (presence==-1){
            db=location.hash.split("#")[2]
            if(controls[db].hasOwnProperty(row.id)){
                return '<i class="glyphicon glyphicon-ok"></i>';
            }
            else
                return '<i class="glyphicon glyphicon-remove"></i>';
        }

     }
    function rowStyle(row) {
        if (row.common == 1 ) { 
            return {
                classes: 'info'
            };
        }
         if (row.common == 2 ) { 
            return {
                classes: 'danger'
            };
        }
        return {};
    }
$('.disabled').click(function(e) {
    e.preventDefault() ;
}) ;
 function load_db_table(){
     sample=location.hash.split("#")[1]
     loadScript("/magneto/static/js/bootstrap-table/dist/bootstrap-table.min.js");
path_table="/magneto/static/results/{{=XML(request.args[0])}}/"+sample+"_bar.json"
path_download="/magneto/static/results/{{=XML(request.args[0])}}/"+mapping_column[sample]+"_statistics.zip"
document.getElementById("db_stats").innerHTML = '<div id="toolbar" class="export btn pull-right"><button class="btn btn-success" onclick="download_table(path_download)" data-toggle="dropdown" type="button"><i class="glyphicon glyphicon-download-alt"></i> Download</button></div><table id="table_db" class="table table-hover table-no-bordered" data-toggle="table" data-url='+path_table+'><thead><th data-field="database" data-align="left" data-sortable="true">Database</th><th data-field="Standard" data-align="left" data-sortable="true">Standard</th><th data-field="Shared" data-align="left" data-sortable="true">Shared</th><th data-field="MAGNETO" data-align="left" data-sortable="true">MAGNETO</th><th data-field="Total" data-align="left" data-sortable="true">Total</th></tr></thead></table>';
}
    
    function download_table(path){
        window.location.assign(path);
    }
</script>
